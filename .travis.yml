language: c

os:
  - linux
  - osx

sudo: false

notifications:
  email: false

env:
  global:
    - SETUP_XVFB=True
    - CONDA_CHANNELS="astrofrog/label/dev"
    - CONDA_DEPENDENCIES="astropy qtpy traitlets ipywidgets>=7.0 ipyevents widgetsnbextension pyqt pytest pytest-cov requests nomkl matplotlib beautifulsoup4 lxml jupyterlab flask flask-cors pyopengl notebook jupyter jupyter_client jupyter_console jupyter_core jupyterlab_launcher"
    - PIP_DEPENDENCIES="sphinx-automodapi numpydoc sphinx_rtd_theme pytest-faulthandler codecov reproject"
  matrix:
    # test minimum versions and higher of pywwt's dependencies, as found in...
    # https://github.com/WorldWideTelescope/pywwt/pull/149#issuecomment-464211269
    - PYTHON_VERSION=3.6 JUPYTER_VERSION=1.0.0

    - PYTHON_VERSION=3.6 JUPYTER_CLIENT_VERSION=5.1.0
    - PYTHON_VERSION=3.6 JUPYTER_CLIENT_VERSION=5.2.0

    - PYTHON_VERSION=3.6 JUPYTER_CONSOLE_VERSION=5.0.0
    - PYTHON_VERSION=3.6 JUPYTER_CONSOLE_VERSION=6.0.0

    - PYTHON_VERSION=3.6 JUPYTER_CORE_VERSION=4.4.0

    - PYTHON_VERSION=3.6 JUPYTERLAB_VERSION=0.30.0
    - PYTHON_VERSION=3.6 JUPYTERLAB_VERSION=0.35.4

    - PYTHON_VERSION=3.6 JUPYTERLAB_LAUNCHER_VERSION=0.3.0
    - PYTHON_VERSION=3.6 JUPYTERLAB_LAUNCHER_VERSION=0.5.0
    - PYTHON_VERSION=3.6 JUPYTERLAB_LAUNCHER_VERSION=0.7.0
    - PYTHON_VERSION=3.6 JUPYTERLAB_LAUNCHER_VERSION=0.13.0

    - PYTHON_VERSION=3.6 NOTEBOOK_VERSION=5.0.0
    - PYTHON_VERSION=3.6 NOTEBOOK_VERSION=5.7.5

install:
  - git clone git://github.com/astropy/ci-helpers.git
  - source ci-helpers/travis/setup_conda.sh

script:
  - python setup.py sdist
  - pip install dist/*.tar.gz --verbose
  - jupyter nbextension list
  - jupyter labextension list
  - jupyter serverextension list
  - python .check_enabled.py
  # For now the image tests don't work well on macOS, which requires
  # WebEngine. The tests only pass if the Qt window is always in the
  # foreground.
  - if [[ $TRAVIS_OS_NAME == linux ]]; then pytest pywwt --cov pywwt; fi
  - make -C docs html linkcheck

after_success:
  - codecov
