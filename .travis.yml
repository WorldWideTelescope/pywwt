language: c

os:
  - windows

sudo: false

notifications:
  email: false

env:
  global:
    - SETUP_XVFB=True
    - CONDA_DEPENDENCIES="nodejs"
    - CONDA_CHANNELS="wwt/label/dev"
  matrix:
    - PYTHON_VERSION=2.7
    - PYTHON_VERSION=3.6
    - PYTHON_VERSION=3.7

install:
  - git clone git://github.com/astropy/ci-helpers.git
  - source ci-helpers/travis/setup_conda.sh

script:

  - pip install numpy pyopengl
  - pip install "PyQt5==5.9.*"
  - pip install .[test,docs]

  # TODO: replicate following with tox
  # - python setup.py sdist
  # - cd dist && pip install *.tar.gz --verbose && cd ..

  - jupyter nbextension list
  - jupyter labextension list
  - jupyter serverextension list
  - python .check_enabled.py

  # For now the image tests don't work well on MacOS X, which requires WebEngine. The
  # tests only pass if the Qt window is always in the foreground.
  - if [[ $TRAVIS_OS_NAME != osx ]]; then pytest pywwt --cov pywwt; fi
  - if [[ $TRAVIS_OS_NAME != windows ]]; make -C docs html linkcheck

after_success:
  - codecov
